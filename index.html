<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Acioai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:#0f1220;
  color:#fff;
}
header{
  display:flex;
  align-items:center;
  padding:12px 16px;
  background:#13162a;
}
header img{height:36px;margin-left:10px}
header h1{font-size:18px;font-weight:600}

#container{
  display:flex;
  height:calc(100vh - 60px);
}

/* Sidebar */
aside{
  width:280px;
  background:#12152b;
  padding:16px;
  border-left:1px solid #1f2340;
}
.profile{
  margin-bottom:20px;
}
.profile div{margin:6px 0;font-size:14px}
.btn{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#2d7cff;
  border:none;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
}
.btn.secondary{background:#22254a}

/* Chat */
main{
  flex:1;
  display:flex;
  flex-direction:column;
}
#messages{
  flex:1;
  padding:20px;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  margin-bottom:14px;
  padding:12px 14px;
  border-radius:14px;
  line-height:1.6;
}
.user{
  background:#2d7cff;
  margin-left:auto;
}
.ai{
  background:#1e2140;
}
.admin{
  background:#1f7a4d;
}

/* Input */
#inputBar{
  display:flex;
  padding:12px;
  border-top:1px solid #1f2340;
}
#inputBar input{
  flex:1;
  padding:12px;
  border-radius:10px;
  border:none;
  outline:none;
}
#sendBtn{
  width:48px;
  margin-right:8px;
  border:none;
  background:#2d7cff;
  border-radius:10px;
  cursor:pointer;
}
#sendBtn i{color:#fff;font-size:18px}

/* Ads */
.ad{
  background:#181b35;
  border-radius:10px;
  margin-top:12px;
  overflow:hidden;
  cursor:pointer;
}
.ad img{width:100%;display:block}
.ad div{padding:10px;font-size:14px}
</style>
</head>

<body>

<header>
  <img src="https://cdn.imgurl.ir/uploads/s369564_photo-output.jpeg">
  <h1>Acioai</h1>
</header>

<div id="container">
  <aside>
    <div class="profile">
      <div id="pName">کاربر</div>
      <div id="pSub">اشتراک: Free</div>
      <div id="pRemain">پیام باقی‌مانده: -</div>
    </div>
    <button class="btn" onclick="switchMode('ai')">چت با هوش مصنوعی</button>
    <button class="btn secondary" onclick="switchMode('support')">پشتیبانی</button>
    <div id="ads"></div>
  </aside>

  <main>
    <div id="messages"></div>
    <div id="inputBar">
      <button id="sendBtn"><i class="fa-solid fa-paper-plane"></i></button>
      <input id="text" placeholder="پیام خود را بنویسید..." />
    </div>
  </main>
</div>

<script>
const API_BASE="https://script.google.com/macros/s/AKfycbxiq1R7JoKZ_zfOCHwVwmCzZrkV43Kp_hZnDyVkF3zFCCBnVWLylQ-fQAio_xHL4Srd/exec";
let mode="ai";
let user=JSON.parse(localStorage.getItem("acio_user"))||{
  userid:"demo",
  name:"کاربر",
  subscription:"Free"
};

document.getElementById("pName").innerText=user.name;
document.getElementById("pSub").innerText="اشتراک: "+user.subscription;

function switchMode(m){
  mode=m;
  document.getElementById("messages").innerHTML="";
}

function addMessage(text,cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.innerText=text;
  document.getElementById("messages").appendChild(d);
  d.scrollIntoView({behavior:"smooth"});
}

function typeMessage(text){
  const d=document.createElement("div");
  d.className="msg ai";
  document.getElementById("messages").appendChild(d);
  let i=0;
  const t=setInterval(()=>{
    d.innerText+=text[i++];
    d.scrollIntoView({behavior:"smooth"});
    if(i>=text.length) clearInterval(t);
  },20);
}

document.getElementById("sendBtn").onclick=()=>{
  const v=text.value.trim();
  if(!v) return;
  text.value="";
  addMessage(v,"user");

  const action=mode==="ai"?"chat":"support_send";
  fetch(`${API_BASE}?action=${action}&userid=${user.userid}&text=${encodeURIComponent(v)}`)
    .then(r=>r.json())
    .then(j=>{
      if(!j.ok){typeMessage("خطا در سیستم");return;}
      typeMessage(j.result.reply||"ارسال شد");
      if(j.result.remaining!==undefined){
        document.getElementById("pRemain").innerText="پیام باقی‌مانده: "+j.result.remaining;
      }
    });
};

// Ads
fetch(API_BASE+"?action=ads")
.then(r=>r.json())
.then(j=>{
  if(!j.ok) return;
  j.result.forEach(a=>{
    const d=document.createElement("div");
    d.className="ad";
    d.innerHTML=`<img src="${a.image}"><div>${a.title}</div>`;
    d.onclick=()=>window.open(a.link,"_blank");
    document.getElementById("ads").appendChild(d);
  });
});
</script>

</body>
</html>
