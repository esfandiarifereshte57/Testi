<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Acioai</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:#0e1020;
  color:#fff;
}
.hidden{display:none}

/* ---------- Auth ---------- */
#auth{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.auth-box{
  width:340px;
  background:#141733;
  padding:24px;
  border-radius:14px;
}
.auth-box img{
  display:block;
  margin:0 auto 14px;
  height:48px;
}
.auth-box h2{text-align:center;margin-bottom:20px}
.auth-box input{
  width:100%;
  margin-bottom:10px;
  padding:12px;
  border-radius:10px;
  border:none;
}
.auth-box button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#2d7cff;
  color:#fff;
  cursor:pointer;
  margin-top:8px;
}
.switch{
  text-align:center;
  margin-top:12px;
  font-size:14px;
  cursor:pointer;
  color:#9bb7ff;
}

/* ---------- Layout ---------- */
header{
  display:flex;
  align-items:center;
  padding:12px 16px;
  background:#13162a;
}
header img{height:36px;margin-left:10px}
header span{font-weight:600}

#layout{
  display:flex;
  height:calc(100vh - 60px);
}

/* Sidebar */
aside{
  width:280px;
  background:#12152b;
  padding:16px;
  border-left:1px solid #1f2340;
}
.profile div{margin:6px 0;font-size:14px}
.nav-btn{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#1f2340;
  border:none;
  border-radius:8px;
  color:#fff;
  cursor:pointer;
}
.nav-btn.active{background:#2d7cff}

/* Ads */
.ad{
  background:#181b35;
  border-radius:10px;
  margin-top:12px;
  overflow:hidden;
  cursor:pointer;
}
.ad img{width:100%}
.ad div{padding:8px;font-size:13px}

/* Chat */
main{
  flex:1;
  display:flex;
  flex-direction:column;
}
#messages{
  flex:1;
  padding:20px;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  margin-bottom:14px;
  padding:12px 14px;
  border-radius:14px;
  line-height:1.6;
}
.user{background:#2d7cff;margin-left:auto}
.ai{background:#1e2140}
.admin{background:#1f7a4d}

/* Input */
#inputBar{
  display:flex;
  padding:12px;
  border-top:1px solid #1f2340;
}
#text{
  flex:1;
  padding:12px;
  border-radius:10px;
  border:none;
}
#send{
  width:48px;
  margin-right:8px;
  border:none;
  border-radius:10px;
  background:#2d7cff;
  cursor:pointer;
}
#send i{color:#fff}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth">
  <div class="auth-box">
    <img src="https://cdn.imgurl.ir/uploads/s369564_photo-output.jpeg">
    <h2 id="authTitle">ورود</h2>
    <input id="name" placeholder="نام" class="hidden">
    <input id="username" placeholder="نام کاربری">
    <input id="password" type="password" placeholder="رمز عبور">
    <button onclick="submitAuth()">ادامه</button>
    <div class="switch" onclick="toggleAuth()">ثبت‌نام</div>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
<header>
  <img src="https://cdn.imgurl.ir/uploads/s369564_photo-output.jpeg">
  <span>Acioai</span>
</header>

<div id="layout">
  <aside>
    <div class="profile">
      <div id="pName"></div>
      <div id="pSub"></div>
      <div id="pRemain"></div>
    </div>
    <button class="nav-btn active" onclick="setMode('ai')">چت با هوش مصنوعی</button>
    <button class="nav-btn" onclick="setMode('support')">پشتیبانی</button>
    <div id="ads"></div>
  </aside>

  <main>
    <div id="messages"></div>
    <div id="inputBar">
      <button id="send"><i class="fa-solid fa-paper-plane"></i></button>
      <input id="text" placeholder="پیام خود را بنویسید...">
    </div>
  </main>
</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxiq1R7JoKZ_zfOCHwVwmCzZrkV43Kp_hZnDyVkF3zFCCBnVWLylQ-fQAio_xHL4Srd/exec";
let mode="ai";
let signup=false;
let user=JSON.parse(localStorage.getItem("acio_user"));

if(user) startApp();

function toggleAuth(){
  signup=!signup;
  document.getElementById("name").classList.toggle("hidden",!signup);
  document.getElementById("authTitle").innerText=signup?"ثبت‌نام":"ورود";
  document.querySelector(".switch").innerText=signup?"ورود":"ثبت‌نام";
}

function submitAuth(){
  const u=username.value,p=password.value,n=name.value;
  const action=signup?"signup":"login";
  let url=`${API}?action=${action}&username=${u}&password=${p}`;
  if(signup) url+=`&name=${n}`;
  fetch(url).then(r=>r.json()).then(j=>{
    if(!j.ok){alert("خطا");return;}
    user=j.result;
    localStorage.setItem("acio_user",JSON.stringify(user));
    startApp();
  });
}

function startApp(){
  auth.classList.add("hidden");
  app.classList.remove("hidden");
  pName.innerText=user.name;
  pSub.innerText="اشتراک: "+user.subscription;
  loadAds();
}

function setMode(m){
  mode=m;
  messages.innerHTML="";
  document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

function addMsg(t,c){
  const d=document.createElement("div");
  d.className="msg "+c;
  d.innerText=t;
  messages.appendChild(d);
  d.scrollIntoView({behavior:"smooth"});
}

function typeMsg(t){
  const d=document.createElement("div");
  d.className="msg ai";
  messages.appendChild(d);
  let i=0;
  const it=setInterval(()=>{
    d.innerText+=t[i++];
    d.scrollIntoView();
    if(i>=t.length) clearInterval(it);
  },20);
}

send.onclick=()=>{
  if(!text.value) return;
  const v=text.value;
  text.value="";
  addMsg(v,"user");
  const a=mode==="ai"?"chat":"support_send";
  fetch(`${API}?action=${a}&userid=${user.userid}&text=${encodeURIComponent(v)}`)
  .then(r=>r.json()).then(j=>{
    if(!j.ok){typeMsg("خطا در سیستم");return;}
    typeMsg(j.result.reply||"ارسال شد");
    if(j.result.remaining!==undefined)
      pRemain.innerText="پیام باقی‌مانده: "+j.result.remaining;
  });
};

function loadAds(){
  fetch(API+"?action=ads").then(r=>r.json()).then(j=>{
    if(!j.ok) return;
    j.result.forEach(a=>{
      const d=document.createElement("div");
      d.className="ad";
      d.innerHTML=`<img src="${a.image}"><div>${a.title}</div>`;
      d.onclick=()=>window.open(a.link,"_blank");
      ads.appendChild(d);
    });
  });
}
</script>

</body>
</html>
